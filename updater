#!/bin/bash

PARAM_1=$1
PARAM_2=$2
RCol='\e[0m';
Yel='\e[0;33m';
Red='\e[0;31m';
Gre='\e[0;32m';

show_commands() {
    cat << EOF
    ðŸ”¹ Ubuntu/Debian Updater ðŸ”¹
    Automates system updates, upgrades, and cleanup tasks.

    ðŸ“Œ Usage:
      updater [OPTION]

    ðŸ› ï¸ Options:
      -h, --help             Show this help message.
      -v, --version          Show script version.

    ðŸ”§ System Maintenance
    (no args)   Update, upgrade and clean all

    ðŸ“š Available options

    clean       Clean downloaded .deb packages from cache
    cache:stats Show cache statistics

    ðŸ“¦ Package Management
    package:install <pkg>      Install a package
    package:installed          List installed packages
    package:upgrade <pkg>      Upgrade specific package
    package:remove <pkg>       Remove a package
    package:find <pkg>         Search for a package
    package:download <pkg>     Download package source code
    package:dependencies <pkg> Check package dependencies
    package:description <pkg>  Show package description
    package:descriptions       List all packages with descriptions

    ðŸ”„ PPA Management
    ppa:list          List configured PPAs
    ppa:install <ppa> Add a PPA
    ppa:remove <ppa>  Remove a PPA

    ðŸ’¾ Memory Management
    memory:info     Show memory information
    freemem         Free up memory
    killport <port> Kill process using a port

    ðŸ’¡ Tip: Replace <pkg> with package name and <ppa> with PPA path
    ðŸ”— Repository: https://github.com/alexperezortuno/ubuntu-updater
EOF
}

case "$PARAM_1" in
    -v|--version)
        echo -e "${Yel}Version 1.0.0${RCol}\n";
        exit 0
    ;;
    "clean")
      echo -e "${Yel}";
      sudo apt autoremove; sudo apt clean; sudo apt autoclean
      echo -e "${RCol}";
      exit 0
    ;;
    "package:remove")
      if [[ "$PARAM_2" != "" ]]
      then
        echo -e "${Yel}Removing package ${PARAM_2}${RCol}\n";
        sudo apt remove --purge "$PARAM_2"
        sudo apt autoremove
        sudo apt clean
        exit 0
      else
        echo -e "${Yel}Please tell me what package you want to remove${RCol}\n";
        exit 1
      fi
    ;;
    "package:install")
      sudo apt install "${PARAM_2}"
      exit 0
    ;;
    "package:upgrade")
      if [[ "$PARAM_2" != "" ]]
      then
        echo -e "${Yel}Installing package ${PARAM_2}${RCol}\n";
        sudo apt install "$PARAM_2" --only-upgrade
        exit 0
      else
        echo -e "${Red}Please tell me what package you need information${RCol}\n";
        exit 1
      fi
    ;;
    "package:installed")
      sudo apt list --installed | less
      exit 0
    ;;
    "package:find")
      if [[ "$PARAM_2" != "" ]]
      then
        echo -e "${Yel}Finding package ${PARAM_2}${RCol}\n";
        sudo apt list --installed | grep -i "$PARAM_2"
        exit 0
      else
        echo -e "${Red}Please tell me what package you need to find${RCol}\n";
        exit 1
      fi
    ;;
    "package:description")
      if [[ "$PARAM_2" != "" ]]
      then
        echo -e "${Yel}Finding package ${PARAM_2}${RCol}\n";
        apt-cache show "$PARAM_2" | less
        exit 0
      else
        echo -e "${Red}Please tell me what package you need information${RCol}\n";
        exit 1
      fi
    ;;
    "package:descriptions")
      if [[ "$PARAM_2" != "" ]]
      then
        echo -e "${Yel}Finding package ${PARAM_2}${RCol}\n";
        apt-cache search "$PARAM_2" | less
        exit 0
      else
        echo -e "${Red}Please tell me what package you need to find${RCol}\n";
        exit 1
      fi
    ;;
    "package:dependencies")
      if [[ "$PARAM_2" != "" ]]
      then
        apt-cache showpkg "$PARAM_2" | less
        exit 0
      else
        echo -e "${Red}Please tell me what package you need to see${RCol}\n";
        exit 1
      fi
    ;;
    "package:download")
      if [[ "$PARAM_2" != "" ]]
      then
        sudo apt-get --download-only source "$PARAM_2"
        exit 0
      else
        echo -e "${Red}Please tell me what package needs to download${RCol}\n";
        exit 1
      fi
    ;;
    "package:list")
      dpkg --list
      exit 0
    ;;
    "ppa:list")
      apt policy
      exit 0
    ;;
    "ppa:install")
        if [[ "$PARAM_2" != "" ]]
        then
            sudo add-apt-repository ppa:"$PARAM_2" -y
            sudo apt update
            exit 0
        else
            echo -e "${Red}Please need a PPA ${RCol}\n";
            exit 1
        fi
    ;;
    "ppa:remove")
        if [[ "$PARAM_2" != "" ]]
        then
            sudo add-apt-repository --remove ppa:"$PARAM_2" -y
            sudo apt update
            exit 0
        else
            echo -e "${Red}Please tell me what ppa needs remove${RCol}\n";
            exit 1
        fi
    ;;
    "cache:stats")
      apt-cache stats
      exit 0
    ;;
    "memory:info")
      if [[ "$PARAM_2" != "" ]]
      then
        sudo dmidecode --type 17 | more
      else
        # sudo dmidecode --type 17
        # sudo lshw -short -C memory
        sudo dmidecode --type 17  | grep -i speed
      fi
      exit 0
    ;;
    "killport")
        echo -e "${Yel}Please write port to kill:  ${RCol}\r"
        read -r PORT
        sudo kill -9 "$(sudo lsof -t -i:"${PORT}")"
        exit 0
    ;;
    "freemem")
        free -h
        su -c "echo 3 > /proc/sys/vm/drop_caches && swapoff -a && swapon -a && printf '\n%s\n' 'Ram-cache and Swap Cleared'" root
        # echo 3 > /proc/sys/vm/drop_caches && swapoff -a && swapon -a && printf '\n%s\n' 'Ram-cache and Swap Cleared'
        free -h
        exit 0
    ;;
    -h|--help)
        show_commands
        exit 0
    ;;
    *)
      echo -e "${Yel} Updating packages ${RCol}";
      sudo apt update; apt list --upgradable && sudo apt upgrade -y && sudo apt autoremove; sudo apt clean; sudo apt autoclean
      exit 0
    ;;
esac
